<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Statewise Weekly Current Affairs</title>
<style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    input { padding: 8px; width: 250px; margin-bottom: 20px; }
    .state-card {
        border: 1px solid #ccc;
        padding: 10px;
        margin-bottom: 10px;
        border-radius: 5px;
    }
    .state-card h3 { margin: 0; }
</style>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>

<h1>Statewise Weekly Current Affairs</h1>
<input type="text" id="search" placeholder="Search state...">
<div id="results"></div>

<script>
    // Supabase connection
    const SUPABASE_URL = "https://frnzwjwdlymvxzjnbzfn.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZybnp3andkbHltdnh6am5iemZuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUyNzY5MDksImV4cCI6MjA3MDg1MjkwOX0.HbfY-_PPhXYXccmqjqBrIQm4LGcItzDre3rbLQACb5o";

    const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    async function loadData() {
        const { data, error } = await supabase
            .from("current_affairs")
            .select("*")
            .order("date", { ascending: false });

        if (error) {
            console.error("Error fetching data:", error);
            return;
        }

        displayData(data);

        // Search functionality
        document.getElementById("search").addEventListener("input", function () {
            const searchValue = this.value.toLowerCase();
            const filtered = data.filter(item => item.state.toLowerCase().includes(searchValue));
            displayData(filtered);
        });
    }

    function displayData(data) {
        const resultsDiv = document.getElementById("results");
        resultsDiv.innerHTML = "";
        data.forEach(item => {
            const card = document.createElement("div");
            card.className = "state-card";
            card.innerHTML = `
                <h3>${item.state}</h3>
                <p><b>${item.title}</b></p>
                <p>${item.description}</p>
                <small>${item.date}</small>
            `;
            resultsDiv.appendChild(card);
        });
    }

    loadData();
</script>

</body>
</html>