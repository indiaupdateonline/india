<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Genres — Indian Literature Archive</title>
  <meta name="description" content="Genres index for the Indian Literature Archive — detailed profiles, sample works and links to book pages." />
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="manifest" href="/site.webmanifest">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans:wght@400;600;700&family=Noto+Serif:400,700&display=swap" rel="stylesheet">

  <style>
    :root{--accent:#0b6b6b;--dark:#0b2b3a;--muted:#6b7280;--bg:#fbfefe;--card:#fff;--border:#e6eef0;--radius:10px;--max-width:1150px}
    html,body{margin:0;font-family:"Noto Sans",system-ui,-apple-system,Segoe UI,Roboto,Arial;background:var(--bg);color:var(--dark)}
    a{color:var(--accent);text-decoration:none}
    .container{max-width:var(--max-width);margin:0 auto;padding:18px}
    header.site-header{background:var(--dark);color:#fff;padding:12px 0}
    .header-inner{display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap}
    .branding{display:flex;align-items:center;gap:12px;color:inherit}
    .logo-symbol{width:44px;height:44px;border-radius:6px;background:#fff;color:var(--dark);display:flex;align-items:center;justify-content:center;font-weight:700}
    nav.main-navigation a{color:#fff;padding:8px 10px;border-radius:6px;font-weight:600}
    .mobile-toggle{display:none}
    .hero{background:linear-gradient(180deg, rgba(11,43,58,0.95), rgba(11,43,58,0.85));color:#fff;padding:28px 0;margin-bottom:14px}
    .hero h1{margin:0;font-size:22px}
    main#main-content{padding-bottom:40px}
    .layout{display:grid;grid-template-columns:1fr 360px;gap:18px;align-items:start}
    @media (max-width:980px){ .layout{grid-template-columns:1fr} nav.main-navigation{display:none} .mobile-toggle{display:inline-block} }

    .card{background:var(--card);border-radius:var(--radius);padding:14px;border:1px solid var(--border);box-shadow:0 6px 18px rgba(11,43,58,0.06)}
    .muted{color:var(--muted);font-size:13px}
    .controls{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin-top:12px}

    .genres-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}
    @media (max-width:980px){ .genres-grid{grid-template-columns:1fr} }
    .genre-card{border-left:6px solid var(--accent);padding:14px;cursor:pointer;display:block}
    .genre-title{display:flex;justify-content:space-between;align-items:center;gap:8px}
    .genre-title h3{margin:0;font-size:18px}
    .genre-meta{color:var(--muted);font-size:13px}
    .genre-body{margin-top:10px}
    .chips{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
    .chip{background:#e6f6f6;color:var(--accent);padding:5px 8px;border-radius:999px;font-weight:600;font-size:12px}

    .accordion{border-top:1px solid #f0f6f6;margin-top:12px}
    .accordion-item{border-bottom:1px solid #f2f6f6}
    .accordion-trigger{background:transparent;border:0;width:100%;text-align:left;padding:12px 0;display:flex;justify-content:space-between;align-items:center;gap:12px;cursor:pointer}
    .accordion-panel{padding:6px 0 18px 0;display:none}
    .accordion-panel.show{display:block}

    table{width:100%;border-collapse:collapse;margin-top:10px}
    th,td{padding:10px;border-bottom:1px solid #f1f5f9;text-align:left;font-size:14px}
    th{background:#f8fafc;font-weight:700;color:var(--dark)}

    .book-tile{display:flex;gap:10px;align-items:flex-start;border-bottom:1px solid #f1f5f9;padding:10px 0}
    .book-cover{width:72px;height:108px;border-radius:6px;object-fit:cover;border:1px solid #e6eef0}
    .book-meta h4{margin:0;font-size:15px}
    .book-meta p{margin:6px 0;color:var(--muted);font-size:13px}

    .pagination{display:flex;gap:8px;align-items:center;justify-content:center;padding:12px 0;flex-wrap:wrap}
    .btn{padding:8px 12px;border-radius:8px;border:none;background:var(--accent);color:#fff;font-weight:700;cursor:pointer}
    .btn-ghost{background:transparent;border:1px solid #e6eef0;padding:8px;border-radius:8px;cursor:pointer}
    footer.site-footer{background:var(--dark);color:#fff;padding:18px 0;margin-top:24px}
    .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
  </style>
</head>
<body>
  <a class="sr-only" href="#main-content">Skip to main content</a>

  <header class="site-header" role="banner">
    <div class="container header-inner">
      <a class="branding" href="/" aria-label="Indian Literature Archive home">
        <div class="logo-symbol">IA</div>
        <div>
          <div style="font-weight:700">Indian Literature Archive</div>
          <div style="font-size:12px;color:#cfe7e7">Ancient & Medieval Texts</div>
        </div>
      </a>

      <nav class="main-navigation" role="navigation" aria-label="Main Navigation">
        <a href="/">Home</a>
        <a href="/languages">Languages</a>
        <a href="/periods">Periods</a>
        <a href="/genres" aria-current="page">Genres</a>
        <a href="/resources">Resources</a>
        <a href="/about">About</a>
      </nav>

      <button class="mobile-toggle" aria-controls="mobileMenu" aria-expanded="false">Menu</button>
    </div>
  </header>

  <section class="hero">
    <div class="container">
      <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap">
        <div>
          <h1 style="margin:0;color:#fff">Genres — An Atlas of Literary Forms</h1>
          <p style="margin:6px 0;color:#d6f0f0">Profiles, representative works, editorial guidance, and direct links to book pages.</p>
        </div>
        <div style="display:flex;gap:10px;align-items:center">
          <div class="card" style="padding:10px;text-align:center;min-width:120px">
            <div class="muted" style="color:#d6f0f0">Total genres</div>
            <div id="totalGenres" style="font-weight:800;font-size:18px;margin-top:6px;color:#fff">—</div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <main id="main-content">
    <div class="container">
      <div class="card">
        <div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:12px">
          <div>
            <strong style="font-size:16px">Search & Filter Genres</strong>
            <div class="muted">Filter by name, language, or scope. Click a genre to see detailed profile and sample books.</div>
          </div>
          <div style="display:flex;gap:8px;align-items:center">
            <button id="loadBtn" class="btn-ghost">Load genres.json</button>
            <button id="exportBtn" class="btn-ghost">Export view</button>
          </div>
        </div>

        <div class="controls" style="margin-top:12px">
          <input id="searchInput" type="search" placeholder="Search genres, keywords, titles..." aria-label="Search genres" style="padding:10px;border-radius:8px;border:1px solid #e2e8f0;flex:1">
          <select id="langFilter" style="padding:10px;border-radius:8px;border:1px solid #e2e8f0">
            <option value="">All languages</option>
          </select>
          <select id="scopeFilter" style="padding:10px;border-radius:8px;border:1px solid #e2e8f0">
            <option value="">All scopes</option>
            <option value="performative">Performative/Oral</option>
            <option value="scholarly">Scholarly/Technical</option>
            <option value="narrative">Narrative</option>
          </select>
          <button id="applyBtn" class="btn">Apply</button>
        </div>
      </div>

      <div style="height:12px"></div>

      <div class="layout">
        <section class="left-column">
          <div class="card">
            <strong>Genre Directory</strong>
            <div class="muted" style="margin-top:6px">Click a genre to expand a full profile with representative works and book links.</div>

            <div class="genres-grid" id="genresGrid" style="margin-top:12px">
              <!-- populated by JS -->
            </div>
          </div>

          <div style="height:12px"></div>

          <div class="card accordion" id="encyclopedia" aria-label="Genre encyclopedia">
            <strong>Genre Encyclopedia — long profiles</strong>
            <div class="muted" style="margin-top:6px">Extended entries appear here when you expand a genre.</div>
            <!-- populated by JS -->
          </div>
        </section>

        <aside class="right-column">
          <div class="card" id="detailPanel">
            <div style="display:flex;justify-content:space-between;align-items:center">
              <strong>Selected Genre — details</strong>
              <div class="muted">Select a genre</div>
            </div>
            <div id="detailContent" style="margin-top:10px">
              <p class="muted">No genre selected — select a card to view sample books and editorial notes.</p>
            </div>
          </div>

          <div class="card" style="margin-top:12px">
            <strong>Quick resources</strong>
            <ul style="margin-top:8px">
              <li><a href="/resources/metadata/tei-guidelines.html">TEI Guidelines for Indian Texts</a></li>
              <li><a href="/resources/teaching/genres-syllabus.pdf">Teaching pack: Genres & Methods (PDF)</a></li>
              <li><a href="/resources/reading-lists/epic-poetry.csv">Reading lists (CSV)</a></li>
            </ul>
          </div>
        </aside>
      </div>

      <div style="height:18px"></div>
    </div>
  </main>

  <footer class="site-footer">
    <div class="container" style="display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap">
      <div>
        <div style="font-weight:700">Indian Literature Archive</div>
        <div class="muted">A non-profit initiative preserving India's literary heritage</div>
      </div>
      <div style="text-align:right">
        <div class="muted">© <span id="year"></span> Indian Literature Archive</div>
        <div style="margin-top:6px"><a href="privacy.html">Privacy</a> · <a href="terms.html">Terms</a></div>
      </div>
    </div>
  </footer>

  <script>
    // genres.html client-side script: fetches genres.json and renders UI.
    const genresGrid = document.getElementById('genresGrid');
    const encyclopedia = document.getElementById('encyclopedia');
    const detailContent = document.getElementById('detailContent');
    const totalGenres = document.getElementById('totalGenres');
    const searchInput = document.getElementById('searchInput');
    const langFilter = document.getElementById('langFilter');
    const scopeFilter = document.getElementById('scopeFilter');
    const loadBtn = document.getElementById('loadBtn');
    const applyBtn = document.getElementById('applyBtn');
    const exportBtn = document.getElementById('exportBtn');

    let DATA = { genres: [], books_catalog: [] };

    function escapeHtml(s){ if(s==null) return ''; return String(s).replace(/[&<>"']/g, m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }

    // render genre cards
    function renderGenreCards(list){
      genresGrid.innerHTML = '';
      if(!list.length){ genresGrid.innerHTML = '<div class="muted">No genres found.</div>'; totalGenres.textContent = 0; return; }
      list.forEach(g => {
        const el = document.createElement('article');
        el.className = 'genre-card';
        el.tabIndex = 0;
        el.innerHTML = `
          <div class="genre-title">
            <h3>${escapeHtml(g.name)}</h3>
            <div class="genre-meta">${escapeHtml(g.book_count || (g.books_refs && g.books_refs.length) || '—')} books</div>
          </div>
          <div class="genre-body">
            <div class="muted">${escapeHtml((g.description||'').slice(0,220))}${(g.description && g.description.length>220 ? '…':'' )}</div>
            <div class="chips">${(g.languages||[]).slice(0,4).map(l=>`<span class="chip">${escapeHtml(l)}</span>`).join('')}</div>
          </div>
        `;
        el.addEventListener('click', ()=> openGenreDetail(g));
        el.addEventListener('keydown', (e)=> { if(e.key==='Enter' || e.key===' ') openGenreDetail(g); });
        genresGrid.appendChild(el);
      });
      totalGenres.textContent = list.length;
    }

    // render encyclopedia long entries
    function renderEncyclopedia(list){
      encyclopedia.innerHTML = '';
      list.forEach(g=>{
        const id = g.id || g.name.toLowerCase().replace(/\s+/g,'-');
        const item = document.createElement('div');
        item.className = 'accordion-item';
        item.innerHTML = `
          <button class="accordion-trigger" aria-expanded="false" data-id="${escapeHtml(id)}">
            <div style="display:flex;flex-direction:column;align-items:flex-start">
              <strong>${escapeHtml(g.name)}</strong>
              <span class="muted">${escapeHtml((g.languages||[]).join(', '))}</span>
            </div>
            <span class="muted">Expand</span>
          </button>
          <div class="accordion-panel" id="panel-${escapeHtml(id)}">
            <div>
              <h4>Overview</h4>
              <p>${escapeHtml(g.description || '')}</p>
              <h4>Representative sample books</h4>
              <div>${(g.books_sample||[]).map(b=>`<div class="book-tile">
                <img class="book-cover" src="${escapeHtml(b.cover_url)}" alt="${escapeHtml(b.title)} cover" />
                <div class="book-meta"><h4><a href="${escapeHtml(b.page_url)}">${escapeHtml(b.title)}</a></h4><p class="muted">${escapeHtml(b.author)} • ${escapeHtml(b.year)}</p></div>
              </div>`).join('')}</div>
              <h4 style="margin-top:12px">Research notes</h4>
              <p class="muted">${escapeHtml(g.research_notes || '')}</p>
              <h4>Full index</h4>
              <p class="muted">This entry links to <strong>${escapeHtml(String(g.book_count || (g.books_refs||[]).length))}</strong> catalog records. Use the individual book pages for full bibliographic details.</p>
            </div>
          </div>
        `;
        encyclopedia.appendChild(item);
      });

      // wire accordion
      encyclopedia.querySelectorAll('.accordion-trigger').forEach(t=>{
        t.addEventListener('click', ()=>{
          const panel = t.nextElementSibling;
          const expanded = t.getAttribute('aria-expanded') === 'true';
          t.setAttribute('aria-expanded', String(!expanded));
          t.querySelector('span').textContent = expanded ? 'Expand' : 'Collapse';
          panel.classList.toggle('show', !expanded);
        });
      });
    }

    function openGenreDetail(g){
      detailContent.innerHTML = `
        <h3 style="margin:0">${escapeHtml(g.name)}</h3>
        <div class="muted" style="margin-top:6px">${escapeHtml((g.languages||[]).join(', '))} • ${escapeHtml(String(g.book_count || (g.books_refs||[]).length))} books</div>
        <p style="margin-top:10px">${escapeHtml(g.description || '')}</p>
        <h4 style="margin-top:10px">Sample books</h4>
        <div>${(g.books_sample||[]).map(b => `
          <div class="book-tile">
            <img class="book-cover" src="${escapeHtml(b.cover_url)}" alt="${escapeHtml(b.title)} cover" />
            <div class="book-meta">
              <h4><a href="${escapeHtml(b.page_url)}">${escapeHtml(b.title)}</a></h4>
              <p class="muted">${escapeHtml(b.author)} • ${escapeHtml(String(b.year))}</p>
              <p class="muted">${escapeHtml((b.summary||'').slice(0,120))}${b.summary && b.summary.length>120? '…':''}</p>
            </div>
          </div>` ).join('')}</div>
        <h4 style="margin-top:10px">Access</h4>
        <p class="muted">Click any book to open its page (example pages: <code>/books/&lt;slug&gt;.html</code>). Covers link to placeholder images (picsum.photos) as copyright-free placeholders.</p>
      `;
      // scroll into view for mobile
      detailContent.scrollIntoView({behavior:'smooth', block:'nearest'});
    }

    // simple filter & apply
    function applyFilters(){
      const q = (searchInput.value||'').trim().toLowerCase();
      const lang = (langFilter.value||'').trim();
      const scope = (scopeFilter.value||'').trim();
      let list = DATA.genres.slice();
      if(q){
        list = list.filter(g => (g.name + ' ' + (g.description||'') + ' ' + (g.languages||[]).join(' ')).toLowerCase().includes(q));
      }
      if(lang){
        list = list.filter(g => (g.languages||[]).includes(lang));
      }
      if(scope){
        list = list.filter(g => (g.description||'').toLowerCase().includes(scope) || (g.name||'').toLowerCase().includes(scope));
      }
      renderGenreCards(list);
      renderEncyclopedia(list);
    }

    // load genres.json (assumes server path /data/genres.json or root /genres.json)
    async function loadJSON(urls = ['/data/genres.json','/genres.json','/mnt/data/genres.json','/site-data/genres.json']){
      let res, data;
      for(const u of urls){
        try{
          res = await fetch(u, {cache:'no-store'});
          if(res.ok){ data = await res.json(); console.info('Loaded', u); break; }
        }catch(e){}
      }
      if(!data){
        // fallback: try root /mnt/data path (local dev)
        try{
          const r = await fetch('/mnt/data/genres.json', {cache:'no-store'});
          if(r.ok) data = await r.json();
        }catch(e){}
      }
      if(!data){
        // graceful failure: inform user how to provide genres.json
        genresGrid.innerHTML = '<div class="muted">Could not find genres.json automatically. Place the file at /genres.json or /data/genres.json. For demo, some sample entries are shown.</div>';
        // small built-in demo fallback
        DATA.genres = [{
          id:'epic', name:'Epics', description:'Canonical epic narratives (Mahabharata, Ramayana).', languages:['Sanskrit'], book_count:3,
          books_sample:[{id:'bk00001',title:'Mahabharata — Sample',author:'Vyasa',year:-200,page_url:'/books/mahabharata-sample.html',cover_url:'https://picsum.photos/seed/mahab/400/600',summary:'Sample'}],
          books_refs:[{id:'bk00001',page_url:'/books/mahabharata-sample.html',title:'Mahabharata — Sample'}], research_notes:'Sample'
        }];
        renderGenreCards(DATA.genres);
        renderEncyclopedia(DATA.genres);
        return;
      }
      DATA = data;
      // populate language filter list
      const langs = new Set();
      (DATA.genres||[]).forEach(g => (g.languages||[]).forEach(l=>langs.add(l)));
      langFilter.innerHTML = '<option value="">All languages</option>' + Array.from(langs).sort().map(l=>`<option value="${l}">${l}</option>`).join('');
      renderGenreCards(DATA.genres || []);
      renderEncyclopedia(DATA.genres || []);
    }

    // event wiring
    loadBtn.addEventListener('click', ()=> loadJSON());
    applyBtn.addEventListener('click', applyFilters);
    searchInput.addEventListener('keydown', (e)=> { if(e.key==='Enter') applyFilters(); });
    exportBtn.addEventListener('click', ()=>{
      // export currently visible genres to JSON
      const visible = Array.from(document.querySelectorAll('.genre-card h3')).map(h=>h.textContent);
      alert('You can export current view programmatically. Visible genres: ' + visible.length + ' (console). Check console for full dataset preview.');
      console.log('Visible genres preview:', DATA.genres ? DATA.genres.slice(0,30) : []);
    });

    // initial attempt to auto-load common path
    loadJSON();
    document.getElementById('year').textContent = new Date().getFullYear();
  </script>
</body>
</html>